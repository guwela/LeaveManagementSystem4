@model ReviewLeaveRequestVM

@{
    ViewData["Title"] = "Review Leave Request";
}

<div class="container mt-4">

    <h2 class="mb-4">Review Leave Request</h2>

    <!-- Employee Info -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Requesting Employee</h5>
        </div>
        <div class="card-body">
            <p><strong>Name:</strong> @Model.Employee.FirstName @Model.Employee.LastName</p>
            <p><strong>Email:</strong> @Model.Employee.Email</p>
        </div>
    </div>

    <!-- Leave Request Details -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">Leave Request Details</h5>
        </div>
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3">@Html.DisplayNameFor(model => model.LeaveType)</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.LeaveType)</dd>

                <dt class="col-sm-3">@Html.DisplayNameFor(model => model.StartDate)</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.StartDate)</dd>

                <dt class="col-sm-3">@Html.DisplayNameFor(model => model.EndDate)</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.EndDate)</dd>

                <dt class="col-sm-3">@Html.DisplayNameFor(model => model.RequestComments)</dt>
                <dd class="col-sm-9">@Html.DisplayFor(model => model.RequestComments)</dd>
            </dl>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-start gap-2 mb-4">
        <button type="button" class="btn btn-success btn-lg approvalBtn" data-id="@Model.Id" data-approved="true">
            ✅ Approve
        </button>
        <button type="button" class="btn btn-danger btn-lg approvalBtn" data-id="@Model.Id" data-approved="false">
            ❌ Reject
        </button>
        <a class="btn btn-info btn-lg" asp-action="ListRequests"> 
            🔙 Back To List
        </a>
    </div>

</div>

<!-- Hidden form -->
<form asp-action="Review" id="approvalForm" method="post">
    <input type="hidden" name="id" id="leaveRequestId" />
    <input type="hidden" name="approved" id="approved" />
</form>

<!-- SweetAlert2 -->


<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".approvalBtn").forEach(function (button) {
            button.addEventListener("click", function () {
                let id = this.getAttribute("data-id");
                let approved = this.getAttribute("data-approved") === "true";

                Swal.fire({
                    title: approved ? "Approve Leave?" : "Reject Leave?",
                    text: approved ? 
                          "Do you want to approve this leave request?" : 
                          "Do you want to reject this leave request?",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: approved ? "#28a745" : "#d33",
                    cancelButtonColor: "#3085d6",
                    confirmButtonText: approved ? "Yes, Approve" : "Yes, Reject",
                    cancelButtonText: "No"
                }).then((result) => {
                    if (result.isConfirmed) {   // ✅ Only runs if confirmed
                        // ✅ Set values into hidden form
                        document.getElementById("leaveRequestId").value = id;
                        document.getElementById("approved").value = approved;

                        // ✅ Submit hidden form
                        document.getElementById("approvalForm").submit();
                    }
                });
            });
        });
    });
</script>

